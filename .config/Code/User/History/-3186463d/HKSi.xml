<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="view_br_nfe_invoice_electronic_form" model="ir.ui.view">
        <field name="name">view.br_nfe.invoice.electronic.form</field>
        <field name="model">invoice.electronic</field>
        <field name="inherit_id" ref="br_account_einvoice.br_account_invoice_electronic_form"/>
        <field name="arch" type="xml">
            <div name="alertas" position="before">
                <field name="ambiente_nfe" invisible="1"/>
                <div class="alert alert-danger" role="alert" style="margin-bottom:0px;"
                     attrs="{'invisible': ['|', ('ambiente_nfe', '==', '1'), ('model', 'not in', ('55', '65'))]}">
                    A NFe está em ambiente de homologação
                </div>
                <div class="alert alert-warning" role="alert" style="margin-bottom:0px;"
                     attrs="{'invisible': ['|', '|', ('state', '!=', 'done'), ('model', 'not in', ('55', '65')), ('protocolo_nfe', '!=', False)]}">
                    A NFe está sem Protocolo de Autorização. Por favor, utilize o botão 'Consultar Protocolo' para recuperá-lo.
                </div>
                <div class="alert alert-warning" role="alert" style="margin-bottom:0px;"
                     attrs="{'invisible': ['|', ('finalidade_emissao', '!=', '2'), ('model', 'not in', ('55', '65'))]}">
                    Esta NFe é uma Nota Complementar.
                </div>
            </div>
            <button name="action_cancel_document" position="after">
                <button name="generate_correction_letter" type="object" class="oe_highlight" icon="fa-envelope"
                        string="Carta de Correção" attrs="{'invisible': ['|', ('state', '!=', 'done'), ('model', 'not in', ('55', '65'))]}">
                </button>
                <button name="action_consultar_protocolo_nfe" type="object" class="oe_highlight" icon="fa-search" string="Consultar Protocolo" attrs="{'invisible': ['|', '|', ('state', '!=', 'done'), ('model', 'not in', ('55', '65')), ('protocolo_nfe', '!=', False)]}"/>
                <button name="action_generate_nfe_complementar" type="object" class="oe_highlight" icon="fa-paperclipe" string="Gerar NFe Complementar"  attrs="{'invisible': ['|', '|', ('finalidade_emissao', '!=', '1'), ('state', '!=', 'done'), ('model', 'not in', ('55', '65'))]}"/>
            </button>
            <div name="button_box" position="inside">
                <button name="action_view_complementar_edocs"
                        type="object"
                        class="oe_stat_button"
                        icon="fa-file-text-o" attrs="{'invisible': ['|', ('state', '!=', 'done'), ('count_complementar_ids', '=', 0)]}">
                    <field name="count_complementar_ids"/>
                    <span> NFe Complementar</span>
                </button>
            </div>
            <field name="valor_bruto" position="after">
                <field name="valor_frete"/>
                <field name="valor_seguro"/>
                <field name="valor_despesas"/>
            </field>
            <page name="totais" position="after">
                <page name="transporte" string="Transportes" attrs="{'invisible': [('model', 'not in', ('55', '65'))]}">
                    <group>
                        <group>
                            <field name="modalidade_frete"/>
                            <field name="transportadora_id"/>
                            <field name="placa_veiculo"/>
                        </group>
                        <group>
                            <field name="uf_veiculo"/>
                            <field name="rntc"/>
                        </group>
                    </group>
                    <group string="Reboques">
                        <field name="reboque_ids" nolabel="1" context="{'default_invoice_electronic_id': id}"/>
                    </group>
                    <group string="Volumes">
                        <field name="volume_ids" nolabel="1" context="{'default_invoice_electronic_id': id}"/>
                    </group>
                </page>
                <page name="cobranca" string="Cobrança">
                    <group>
                        <field name="numero_fatura"/>
                        <field name="fatura_bruto"/>
                        <field name="fatura_desconto"/>
                        <field name="fatura_liquido"/>
                    </group>
                    <group string="Duplicatas">
                        <field name="duplicata_ids" nolabel="1" context="{'default_invoice_electronic_id': id}"/>
                    </group>
                    <group name="payments" string="Pagamentos">
                    <field name="statement_ids" nolabel="1" context="{'default_invoice_electronic_id': id}"/>
                    </group>
                </page>
                <page name="exportacao" string="Exportação/Compras" attrs="{'invisible': [('model', 'not in', ('55', '65'))]}">
                    <group>
                        <group string="Exportação">
                            <field name="uf_saida_pais_id" options="{'no_create': True, 'no_create_edit': True}"/>
                            <field name="local_embarque"/>
                            <field name="local_despacho"/>
                        </group>
                        <group string="Compras">
                            <field name="nota_empenho"/>
                            <field name="pedido_compra"/>
                            <field name="contrato_compra"/>
                        </group>
                    </group>
                </page>
                <page name="documentos_relacionados" string="Doc. Relacionados" attrs="{'invisible': [('model', 'not in', ('55', '65'))]}">
                    <field name="fiscal_document_related_ids">
                        <tree>
                            <field name="invoice_related_id"/>
                            <field name="document_type"/>
                            <field name="access_key"/>
                            <field name="serie"/>
                            <field name="internal_number"/>
                        </tree>
                    </field>
                </page>
                <page name="carta_correcao" string="Cartas de Correção" attrs="{'invisible': [('model', 'not in', ('55', '65'))]}">
                    <field name="cartas_correcao_ids">
                        <tree>
                            <field name="sequencial_evento"/>
                            <field name="message"/>
                            <field name="protocolo"/>
                            <field name="datahora_evento"/>
                        </tree>
                    </field>
                </page>
            </page>
            <field name="mensagem_retorno" position="after">
                <span attrs="{'invisible': [('model', 'not in', ('55', '65'))]}">
                    <br/>
                    <b>Chave NFe:</b>
                    <field name="chave_nfe" class="oe_inline" readonly="1"/>
                    <br/>
                    <b>Protocolo Autorização:</b>
                    <field name="protocolo_nfe" class="oe_inline" readonly="1"/>
                </span>
            </field>
            <field name="numero_controle" position="after">
                <field name="nfe_processada_name" invisible="1"/>
                <field name="nfe_processada" filename="nfe_processada_name" attrs="{'invisible': [('model', 'not in', ('55', '65'))]}"/>
                <field name="parent_edoc_id" readonly="1" attrs="{'invisible': ['|', ('finalidade_emissao', '!=', '2'),('model', 'not in', ('55', '65'))]}"/>
                <field name="recibo_nfe" attrs="{'invisible': [('model', 'not in', ('55', '65'))]}"/>
            </field>
            <field name="ambiente" position="after">
                <field name="finalidade_emissao" attrs="{'invisible': [('model', 'not in', ('55', '65'))]}"/>
                <field name="tipo_emissao" attrs="{'invisible': [('model', 'not in', ('55', '65'))]}"/>
                <field name="ind_final" attrs="{'invisible': [('model', 'not in', ('55', '65'))]}"/>
                <field name="ind_pres" attrs="{'invisible': [('model', 'not in', ('55', '65'))]}"/>
                <field name="ind_intermed" attrs="{'invisible': ['|', ('model', 'not in', ('55', '65')),('ind_pres', 'not in', ('2', '3', '4', '9'))]}"/>
                <field name="cnpj_intermed" attrs="{'invisible': ['|', ('model', 'not in', ('55', '65')), ('ind_intermed', '!=', '1')]}"/>
                <field name="id_cad_int_tran" attrs="{'invisible': ['|', ('model', 'not in', ('55', '65')), ('ind_intermed', '!=', '1')]}"/>
                <field name="ind_dest" attrs="{'invisible': [('model', 'not in', ('55', '65'))]}"/>
                <field name="ind_ie_dest" attrs="{'invisible': [('model', 'not in', ('55', '65'))]}"/>
                <field name="natureza_operacao" attrs="{'invisible': [('model', 'not in', ('55', '65'))]}"/>
            </field>
            <field name="valor_cofins" position="after">
                <field name="valor_icms_fcp_uf_dest" attrs="{'invisible': [('model', 'not in', ('55', '65'))]}"/>
                <field name="valor_icms_uf_dest" attrs="{'invisible': [('model', 'not in', ('55', '65'))]}"/>
                <field name="valor_icms_uf_remet" attrs="{'invisible': [('model', 'not in', ('55', '65'))]}"/>
            </field>
        </field>
    </record>

    <!-- invoice.electronic inherit tree view -->
    <record id="sped_base_electronic_doc_tree" model="ir.ui.view">
        <field name="name">invoice.electronic.inherit.view.tree</field>
        <field name="model">invoice.electronic</field>
        <field name="inherit_id" ref="br_account_einvoice.sped_base_electronic_doc_tree"/>
        <field name="arch" type="xml">

            <field name="partner_id" position="replace"/>

            <xpath expr="//field[@name='state']" position="after">
                <field name="partner_id" position="replace"/>
            </xpath>

            <field name="state" position="replace"/>

            <xpath expr="//field[@name='numero']" position="after">
                <field name="state"/>
                <field name="finalidade_emissao"/>
            </xpath>

        </field>
    </record>

</odoo>
