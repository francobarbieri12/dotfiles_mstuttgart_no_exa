<?xml version="1.0"?>
<odoo>

    <report id="report_br_nfse_danfe_fortaleza"
        string="Nota de Serviço - Fortaleza"
        model="invoice.electronic"
        report_type="qweb-pdf"
        file="br_nfse_ginfes.main_template_br_nfse_danfe_fortaleza"
        name="br_nfse_ginfes.main_template_br_nfse_danfe_fortaleza" />

    <record id="report_br_nfse_danfe_fortaleza" model="ir.actions.report">
        <field name="paperformat_id" ref="br_nfse_ginfes.paperformat_br_nfse_ginfes" />
        <field name="name">Nota de Serviço - Fortaleza</field>
        <field name="print_report_name">'%s - NF - %s' % (object.numero, object.partner_id.name)</field>
        <field name="city_id" ref="br_base.city_2304400" />
    </record>

    <template id="danfse_report_template_fortaleza">
        <div class="page" style="font-size:12px;">
            <link rel="stylesheet" type="text/css" href="/br_nfse_ginfes/static/css/danfse.css" />
            <div class="row completa">
                <div class="col-2 centro br">
                    <img src="/br_nfse_ginfes/static/src/img/fortaleza.jpg"
                        alt="Logo Prefeitura Fortaleza"
                        style="max-height:80px;padding-top: 10px;" />
                </div>
                <div class="col-8 centro" style="padding:0px;font-size:20px;"> Prefeitura do
                    Município de Fortaleza <br /> Secretaria Municipal da Fazenda <br />
                    <t
                        t-if="doc.state in ('draft', 'open')">
                        RECIBO PROVISÓRIO DE SERVIÇOS - RPS
                    </t>
                    <t
                        t-if="doc.state in ('done', 'cancel')">
                        NOTA FISCAL ELETRÔNICA DE SERVIÇOS - NFSe
                    </t>
                </div>
                <div class="col-2 bl centro" style="padding-right:0px;">
                    <div style="padding-left: 0px;font-size: 20px;">
                        <t t-if="doc.state in ('draft', 'open')">
                            <span>Número do RPS</span>
                            <br />
                            <span t-esc="str(doc.numero_rps)"></span>
                        </t>
                        <t t-if="doc.state in ('done', 'cancel')">
                            <span>Número da NFS-e</span>
                            <br />
                            <span t-esc="str(doc.numero)"></span>
                        </t>
                    </div>
                </div>
            </div>
            <div class="row" style="border: 1px solid black; padding: 0px;">
                <div class="col-2 rotulo br">
                    Data e Hora da Emissão
                </div>
                <div class="col-2 linha centro br">
                    <span t-field="doc.data_emissao" />
                </div>
                <div class="col-2 rotulo br">
                    Competência
                </div>
                <div class="col-1 linha centro br">
                    <span t-field="doc.data_emissao" t-options='{"format": "MM/yyyy"}' />
                </div>
                <div class="col-2 rotulo br">
                    Código de Verificação
                </div>
                <div class="col-3 linha centro">
                    <span t-field="doc.verify_code" />
                </div>
            </div>
            <div class="row" style="border: 1px solid black; padding: 0px;">
                <div class="col-2 rotulo br">
                    Número do RPS
                </div>
                <div class="col-2 linha centro br">
                    <span t-esc="str(doc.numero_rps)" />
                </div>
                <div class="col-2 rotulo br">
                    No. da NFS-e substituída
                </div>
                <div class="col-1 linha centro br">
                </div>
                <div class="col-2 rotulo br">
                    Local da Prestação
                </div>
                <div class="col-3 linha centro">
                    <span t-field="doc.company_id.city_id" /> - <span
                        t-field="doc.company_id.state_id.code" />
                </div>
            </div>
            <div class="row" style="border: 1px solid black; padding: 0px;">
                <div class="col-12 rotulo">
                    <h6 style="margin:0px;">Prestador de Serviços</h6>
                </div>
            </div>
            <div class="row" style="border: 1px solid black; padding: 0px;">
                <div class="col-2 centro">
                    <img style="max-height:200px;margin-top:30px;max-width:120px;"
                        t-att-src="'data:image/png;base64,%s' % to_text(doc.company_id.logo)" />
                    <br />
                </div>
                <div class="col-10">
                    <div class="row bb bl" style="margin:0px;">
                        <div class="col-2 rotulo br">
                            Razão Social/Nome
                        </div>
                        <div class="col-10 linha">
                            <span t-field="doc.company_id.legal_name" />
                        </div>
                    </div>
                    <div class="row bb bl" style="margin:0px;">
                        <div class="col-2 rotulo br">
                            Nome Fantasia
                        </div>
                        <div class="col-10 linha">
                            <span t-field="doc.company_id.name" />
                        </div>
                    </div>
                    <div class="row bb bl" style="margin:0px;">
                        <div class="col-2 rotulo br">
                            CNPJ/CPF
                        </div>
                        <div class="col-2 linha centro br">
                            <span t-field="doc.company_id.cnpj_cpf" />
                        </div>
                        <div class="col-2 rotulo br">
                            Insc. Municipal
                        </div>
                        <div class="col-1 linha centro br">
                            <span t-field="doc.company_id.inscr_mun" />
                        </div>
                        <div class="col-1 rotulo centro br">
                            Município
                        </div>
                        <div class="col-4 linha">
                            <span t-field="doc.company_id.city_id" /> - <span
                                t-field="doc.company_id.state_id.code" />
                        </div>
                    </div>
                    <div class="row bb bl" style="margin:0px;">
                        <div class="col-2 rotulo br">
                            Endereço e CEP
                        </div>
                        <div class="col-10 linha">
                            <span t-field="doc.company_id.street" />
                            <span
                                t-field="doc.company_id.number" />
                            <span
                                t-field="doc.company_id.district" /> CEP: <span
                                t-field="doc.company_id.zip" />
                        </div>
                    </div>
                    <div class="row bl" style="margin:0px;">
                        <div class="col-2 rotulo br">
                            Complemento:
                        </div>
                        <div class="col-2 linha br">
                            <span style="font-size:11px;" t-field="doc.company_id.street2" />
                        </div>
                        <div class="col-1 rotulo br">
                            Telefone:
                        </div>
                        <div class="col-2 linha centro br">
                            <span t-field="doc.company_id.phone" />
                        </div>
                        <div class="col-1 rotulo br">
                            E-mail:
                        </div>
                        <div class="col-4 centro linha">
                            <span t-field="doc.company_id.email" />
                        </div>
                    </div>
                </div>
            </div>
            <div class="row" style="border: 1px solid black; padding: 0px;">
                <div class="col-12 bb rotulo">
                    <h6 style="margin:0px;">Tomador de Serviços</h6>
                </div>
            </div>
            <div class="row bb bl br">
                <div class="col-2 rotulo br">
                    Razão Social/Nome
                </div>
                <div class="col-10 linha">
                    <span
                        t-raw="doc.commercial_partner_id.legal_name or doc.commercial_partner_id.name" />
                </div>
            </div>
            <div class="row bb bl br">
                <div class="col-2 rotulo br">
                    CNPJ/CPF
                </div>
                <div class="col-2 linha centro br">
                    <span t-field="doc.commercial_partner_id.cnpj_cpf" />
                </div>
                <div class="col-2 rotulo br">
                    Insc. Municipal
                </div>
                <div class="col-1 linha centro br">
                    <span t-field="doc.commercial_partner_id.inscr_mun" />
                </div>
                <div class="col-1 rotulo br">
                    Município
                </div>
                <div class="col-4 linha">
                    <span t-field="doc.commercial_partner_id.city_id" /> - <span
                        t-field="doc.commercial_partner_id.state_id.code" />
                </div>
            </div>
            <div class="row bb bl br">
                <div class="col-2 rotulo br">
                    Endereço e CEP
                </div>
                <div class="col-10 linha">
                    <span t-field="doc.commercial_partner_id.street" />
                    <span
                        t-field="doc.commercial_partner_id.number" />
                    <span
                        t-field="doc.commercial_partner_id.district" /> CEP: <span
                        t-field="doc.commercial_partner_id.zip" />
                </div>
            </div>
            <div class="row bb bl br">
                <div class="col-2 rotulo br">
                    Complemento:
                </div>
                <div class="col-2 linha br">
                    <span t-field="doc.commercial_partner_id.street2" />
                </div>
                <div class="col-1 rotulo centro br">
                    Telefone:
                </div>
                <div class="col-2 linha br">
                    <span t-field="doc.commercial_partner_id.phone" />
                </div>
                <div class="col-1 rotulo br">
                    E-mail:
                </div>
                <div class="col-4 linha centro">
                    <span t-field="doc.commercial_partner_id.email" />
                </div>
            </div>
            <div class="row" style="border: 1px solid black; padding: 0px;">
                <div class="col-12 rotulo">
                    <h6 style="margin:0px;">Discriminação dos serviços</h6>
                </div>
            </div>
            <div class="row" style="border: 1px solid black;padding: 0 0 5px 5px; min-height:150px;">
                <div class="col-12">
                    <t t-foreach="doc.electronic_item_ids" t-as="line">
                        <p t-field="line.name"></p>
                    </t>
                    <span t-field="doc.informacoes_legais"></span>
                    <span t-field="doc.informacoes_complementares"></span>
                    <t t-if="doc.state == 'cancel'">
                        <center>
                            <br />
                            <span style="font-size:60px;color:red !important;">NOTA CANCELADA</span>
                            <br />
                        </center>
                    </t>
                </div>
            </div>

            <div class="row" style="border: 1px solid black; padding: 0px;">
                <div class="col-12 rotulo">
                    <h6 style="margin:0px;">Código do Serviço / Atividade</h6>
                </div>
            </div>
            <div class="row" style="border: 1px solid black; padding: 10px;">
                <div class="col-12">
                    <span
                        t-field="doc.electronic_item_ids[0].invoice_electronic_id.fiscal_position_id.service_type_id.code" />
                    / <span
                        t-field="doc.electronic_item_ids[0].invoice_electronic_id.codigo_tributacao_municipio" />
                    - <span
                        t-field="doc.electronic_item_ids[0].invoice_electronic_id.fiscal_position_id.service_type_id.name" />
                </div>
            </div>
            <div class="row" style="border: 1px solid black; padding: 0px;">
                <div class="col-12 rotulo">
                    <h6 style="margin:0px;">Tributos Federais</h6>
                </div>
            </div>

            <div class="row completa">
                <div class="col-1 rotulo br">
                    PIS(R$)
                </div>
                <div class="col-1 linha br centro">
                    <span t-field="doc.valor_retencao_pis" />
                </div>
                <div class="col-2 rotulo br">
                    COFINS(R$)
                </div>
                <div class="col-2 linha br centro">
                    <span t-field="doc.valor_retencao_cofins" />
                </div>
                <div class="col-1 rotulo br">
                    IR(R$)
                </div>
                <div class="col-1 linha br centro">
                    <span t-field="doc.valor_retencao_irrf" />
                </div>
                <div class="col-1 rotulo br">
                    INSS(R$)
                </div>
                <div class="col-1 linha br centro">
                    <span t-field="doc.valor_retencao_inss" />
                </div>
                <div class="col-1 rotulo br">
                    CSLL(R$)
                </div>
                <div class="col-1 linha centro">
                    <span t-field="doc.valor_retencao_csll" />
                </div>
            </div>

            <div class="row completa">
                <div class="col-5 rotulo br">
                    Detalhamento de Valores - Prestador dos Serviços
                </div>
                <div class="col-3 rotulo br">
                    Outras Informações
                </div>
                <div class="col-4 rotulo">
                    Cálculo do ISSQN devido no Município
                </div>
            </div>

            <div class="row completa">
                <div class="col-3 rotulo esquerda br">
                    Valor dos Serviços R$
                </div>
                <div class="col-2 linha br centro">
                    <span t-field="doc.valor_bruto" />
                </div>
                <div class="col-3 rotulo centro br">
                    Natureza Operação
                </div>
                <div class="col-3 rotulo esquerda br">
                    Valor dos Serviços R$
                </div>
                <div class="col-1 linha centro">
                    <span t-field="doc.valor_bruto" />
                </div>
            </div>

            <div class="row completa">
                <div class="col-3 rotulo esquerda br">
                    (-) Desconto Incondicionado
                </div>
                <div class="col-2 linha centro br">
                    0
                </div>
                <div class="col-3 linha centro br">
                    1-Tributação no município
                </div>
                <div class="col-3 rotulo esquerda br">
                    (-) Deduções permitidas em lei
                </div>
                <div class="col-1 linha centro">
                    0,00
                </div>
            </div>

            <div class="row completa">
                <div class="col-3 rotulo esquerda br">
                    (-) Desconto Condicionado
                </div>
                <div class="col-2 linha centro br">
                    0
                </div>
                <div class="col-3 rotulo br">
                    Regime especial Tributação
                </div>
                <div class="col-3 rotulo esquerda br">
                    (-) Desconto Incondicionado
                </div>
                <div class="col-1 linha centro">
                    0
                </div>
            </div>

            <div class="row completa">
                <div class="col-3 rotulo esquerda br">
                    (-) Retenções Federais
                </div>
                <div class="col-2 linha br centro">
                    <span t-field="doc.retencoes_federais" />
                </div>
                <div class="col-3 linha br centro">
                    0 - Nenhum
                </div>
                <div class="col-3 rotulo esquerda br">
                    Base de Cálculo
                </div>
                <div class="col-1 linha centro">
                    <span t-esc="doc.valor_bruto - doc.valor_desconto" />
                </div>
            </div>

            <div class="row completa">
                <div class="col-3 rotulo esquerda br">
                    Outras Retenções
                </div>
                <div class="col-2 linha br centro">
                    0,00
                </div>
                <div class="col-3 rotulo br">
                    Opção Simples Nacional
                </div>
                <div class="col-3 rotulo esquerda br">
                    (x) Alíquota %
                </div>
                <div class="col-1 linha centro">
                    <span t-field="doc.electronic_item_ids[0].issqn_aliquota" />
                </div>
            </div>

            <div class="row completa">
                <div class="col-3 rotulo esquerda br">
                    (-) ISS Retido
                </div>
                <div class="col-2 linha br centro">
                    <span t-field="doc.valor_retencao_issqn" />
                </div>
                <div class="col-3 linha br centro">
                    <t t-if="doc.company_id.fiscal_type != '3'">
                        1 - Sim
                    </t>
                    <t t-if="doc.company_id.fiscal_type == '3'">
                        2 - Não
                    </t>
                </div>
                <div class="col-3 rotulo esquerda br">
                    ISS a reter:
                </div>
                <div class="col-1 linha centro">
                    <t t-if="not doc.valor_retencao_issqn">
                        ( ) Sim (X) Não
                    </t>
                    <t t-if="doc.valor_retencao_issqn">
                        (X) Sim ( ) Não
                    </t>
                </div>
            </div>

            <div class="row completa">
                <div class="col-3 rotulo esquerda br"> (=) Valor Líquido R$
                </div>
                <div class="col-2 linha br centro">
                    <span t-field="doc.valor_final" />
                </div>
                <div class="col-3 rotulo br">
                    Incentivador Cultural: 2 - Não
                </div>
                <div class="col-3 rotulo esquerda br">
                    (=) Valor do ISS: R$
                </div>
                <div class="col-1 linha centro">
                    <span t-field="doc.valor_issqn" />
                </div>
            </div>

            <div class="row" style="border: 1px solid black;padding: 0px;">
                <div class="col-1 linha">
                    Avisos
                </div>
                <div class="col-11 linha bl"> 1- Uma via desta Nota Fiscal será enviada através do
                    e-mail fornecido pelo Tomador dos Serviços.<br /> 2- A autenticidade desta Nota
<<<<<<< HEAD
                    Fiscal poderá ser verificada no site, <a href="https://saocaetano.ginfes.com.br">
                    saocaetano.ginfes.com.br</a> com a utilização do Código de Verificação.<br />
            <t
                        t-if="doc.company_id.fiscal_type != '3'">
                        3 - Documento emitido por ME ou EPP optante pelo Simples Nacional.Não gera
                    direito a crédito fiscal de ISS e IPI.
=======
                    Fiscal poderá ser verificada no site, <a href="https://iss.fortaleza.ce.gov.br/grpfor/login.seam?cid=167685">
                    iss.fortaleza.ce.gov.br</a> com a utilização do Código de Verificação.<br />
                    <t t-if="doc.company_id.fiscal_type != '3'">
                        3 - Documento emitido por ME ou EPP optante pelo Simples Nacional.Não gera
                            direito a crédito fiscal de ISS e IPI.
>>>>>>> Habilita emissao de NFSe Ginfes para Fortaleza
                    </t>
                </div>
            </div>
        </div>
    </template>

    <template id="main_template_br_nfse_danfe_fortaleza">
        <t t-call="web.html_container">
            <div class="article">
                <t t-foreach="docs" t-as="doc">
                    <t t-call="br_nfse_ginfes.danfse_report_template_fortaleza"
                        t-lang="doc.partner_id.lang" />
                </t>
            </div>
        </t>
    </template>

</odoo>