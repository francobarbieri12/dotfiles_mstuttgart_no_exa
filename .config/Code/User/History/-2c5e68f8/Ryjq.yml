---

- name: Cria diretorios para os arquivos de log e 'odoo.cfg' do usuario "{{ odoo_user }}"
  become: yes
  file:
    path: "{{ item }}"
    state: directory
    owner: "{{ odoo_user }}"
    mode: 02775
  loop:
    - "{{ odoo_config_path }}"
    - "{{ odoo_log_path }}"

# Adiciona nossa chave a lista de chaves do novo usuario odoo_use
# desse modo conseguimos rodar os comandos como esse usuario
# - name: Copia 'authorized_keys' para novo usuario "{{ odoo_user }}"
#   become: yes
#   authorized_key:
#     user: "{{ odoo_user }}"
#     state: present
#     key: "{{ lookup('file', '~/.ssh/id_rsa.pub') }}"


- name: Cria entrada de cron para limpeza periodica da pasta /tmp
  ansible.builtin.cron:
    name: "Limpa os arquivos da pasta /tmp dos ultimos 3 dias"
    minute: "0"
    hour: "4"
    job: "sudo find /tmp -type f -atime +3 -delete"
